<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>aframe-atoll-terrain primitive example</title>
    <meta name="description" content="An example A-Frame WebVR scene with an aframe-atoll-terrain (and an aframe-simple-sun-sky)">
    <script src="https://aframe.io/releases/0.9.2/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-simple-sun-sky@^1.2.2/simple-sun-sky.js"></script>
    <script src="dist/aframe-atoll-terrain.js"></script>
    <!--<script src="https://unpkg.com/aframe-atoll-terrain@^0.9.0/dist/aframe-atoll-terrain.js"></script>-->
    <script src="https://cdn.rawgit.com/donmccurdy/aframe-extras/v6.0.0/dist/aframe-extras.controls.min.js"></script>
    <script>
AFRAME.registerComponent('moving-sun', {
    init: function () {
        this.positionSph = new THREE.Spherical(1, Math.PI/2, 0);
        this.position = new THREE.Vector3();
        this.atollTerrain = document.querySelector('a-atoll-terrain');
        this.sss = document.querySelector('a-simple-sun-sky');
        this.directional = document.getElementById('directional');
    },

    tick: function (time) {
        this.positionSph.phi = Math.PI * (0.3 - 0.15 * Math.sin(time / 32000 * 2 * Math.PI));
        this.positionSph.theta = 2 * Math.PI * ( 0.25 + time / 48000);
        this.position.setFromSpherical(this.positionSph);
        let positionStr = this.position.x + ' ' + this.position.y + ' ' + this.position.z;
//        console.log(positionStr);
        this.atollTerrain.setAttribute('sun-position', positionStr);
        this.sss.setAttribute('sun-position', positionStr);
        this.directional.setAttribute('position', positionStr);
    }
});
    </script>
</head>
<body>
<a-scene moving-sun>
    <a-simple-sun-sky sun-position="0.8 0.6 0"></a-simple-sun-sky>
    <a-entity light="type: ambient; color: #888"></a-entity>
    <a-entity id="directional" light="type: directional; color: #FFF; intensity: 0.6" position="0.7 0.4 -1"></a-entity>

    <a-sphere position="0 16.6 -5" radius="0.6" color="#EF2D5E" shadow></a-sphere>
    <!-- terrain which is likely to have a good vista from the plateau, and runs well on mobile -->
    <a-atoll-terrain mean-elevation="-20"
                     plateau-radius="5" plateau-elevation="15"
                     middle-radius="400" unit-size="4" far="4000"
                     sun-position="0.8 0.6 0"
                     log="true" flat-shading="false">
    </a-atoll-terrain>

    <a-entity id="armature" position="0 15 0" movement-controls="fly:true; speed:0.5">
        <a-entity camera position="0 1.6 0" look-controls="pointerLockEnabled: true"></a-entity>
        <a-entity hand-controls="left"></a-entity>
        <a-entity hand-controls="right"></a-entity>
    </a-entity>
</a-scene>
</body>
</html>
